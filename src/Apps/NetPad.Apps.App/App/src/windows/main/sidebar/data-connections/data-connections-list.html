<h6>
    <div class="d-flex justify-content-between">
        <b class="ps-3 text-truncate">Connections</b>
        <i class="action-icon add-database-connection-icon pe-2"
           title="Add Connection"
           click.trigger="addConnection()"></i>
    </div>
    <hr class="m-0 mt-2" style="height: 2px"/>
</h6>

<div if.bind="!dataConnections.length" class="flex-grow-1 d-flex align-items-center justify-content-center">
    <p class="text-muted">
        No connections
    </p>
</div>

<div else class="flex-grow-height-restricted d-flex">
    <div class="list-group overflow-y-auto" style="width: 100%">
        <div class="list-group-item d-flex flex-column"
             repeat.for="connection of dataConnections">

            <div class="list-group">
                <div class="list-group-item d-flex align-items-center justify-content-between data-connection"
                     data-connection-id="${connection.id}">
                    <div class="d-flex align-items-center text-truncate">
                        <i class="${connection.expanded ? 'tree-collapse-node-icon' : 'tree-expand-node-icon'} action-icon icon-sm me-1"
                           click.trigger="connection.toggleExpand()"></i>
                        <data-connection-name connection.bind="connection"></data-connection-name>
                    </div>
                    <span class="badge bg-secondary rounded-pill ms-2" if.bind="connection.loadingStructure">
                        Loading...
                    </span>
                    <span class="badge bg-danger rounded-pill ms-2 text-truncate" if.bind="connection.error" title.bind="connection.error">
                        ${connection.error}
                    </span>
                </div>

                <div class="list-group-item data-connection-structure-tree ${connection.structure.schemas.length == 1 ? 'single-schema' : ''}" show.bind="connection.expanded">
                    <div class="list-group"
                         if.bind="connection.structure">
                        <div class="list-group-item db-schema"
                             repeat.for="schema of connection.structure.schemas">
                            <span class="display-text" if.bind="connection.structure.schemas.length > 1">
                                ${schema.name}
                            </span>
                            <div class="list-group">
                                <div class="list-group-item db-table"
                                     repeat.for="table of schema.tables">
                                    <div class="display-text d-flex align-items-center">
                                        <img src="/img/table.png"/>
                                        ${table.name}
                                    </div>
                                    <div class="list-group">
                                        <div class="list-group-item db-column"
                                             repeat.for="column of table.columns"
                                             title="DB Type: ${column.type}">
                                            <div class="display-text d-flex align-items-center">
                                                <img src="/img/column.png"/>
                                                ${column.name}
                                                <i class="primary-key-icon icon-xs text-yellow ms-2"
                                                   title="Primary key"
                                                   if.bind="column.isPrimaryKey"></i>
                                                <i class="foreign-key-icon icon-xs text-blue ms-2"
                                                   title="Foreign key"
                                                   if.bind="column.isForeignKey"></i>
                                                <span class="db-column-type text-muted">(${column.clrType})</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<context-menu options.bind="tabContextMenuOptions"></context-menu>
